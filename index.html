<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="description" content="None" /><link rel="canonical" href="https://curts0.github.io/PyTabular/" />
      <link rel="shortcut icon" href="img/favicon.ico" />
    <title>PyTabular</title>
    <link rel="stylesheet" href="css/theme.css" />
    <link rel="stylesheet" href="css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Home";
        var mkdocs_page_input_path = "index.md";
        var mkdocs_page_url = "/PyTabular/";
      </script>
    
    <script src="js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="." class="icon icon-home"> PyTabular
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="./search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href=".">Home</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#what-is-it">What is it?</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#getting-started">Getting Started</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#use-cases">Use Cases</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#if-blank-table-then-refresh-table">If blank table, then refresh table.</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#sneak-in-a-refresh">Sneak in a refresh.</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#show-refresh-times-in-model">Show refresh times in model.</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#if-bpa-violation-then-revert-deployment">If BPA Violation, then revert deployment.</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#backup-revert-a-table">Backup &amp; Revert a Table.</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#loop-through-and-query-dax-files">Loop through and query Dax files</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#advanced-refreshing-with-pre-and-post-checks">Advanced Refreshing with Pre and Post Checks</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#query-as-another-user">Query as Another User</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#refresh-related-tables">Refresh Related Tables</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#contributing">Contributing</a>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="Tabular/">Tabular</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="Table/">Table</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="Partition/">Partition</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="Column/">Column</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="Traces/">Trace</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="Queries/">Queries</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="Best%20Practice%20Analyzer/">Best Practice Analyzer</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="Tabular%20Editor%202/">Tabular Editor</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="Logic%20Utils/">Logic Utils</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="Examples/">Examples</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href=".">PyTabular</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="." class="icon icon-home" alt="Docs"></a> &raquo;</li>
      <li>Home</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="pytabular">PyTabular</h1>
<p><a href="https://badge.fury.io/py/python-tabular"><img alt="PyPI version" src="https://badge.fury.io/py/python-tabular.svg" /></a>
<a href="https://pepy.tech/project/python-tabular"><img alt="Downloads" src="https://pepy.tech/badge/python-tabular" /></a>
<a href="https://github.com/Curts0/PyTabular/actions/workflows/readthedocs.yml"><img alt="readthedocs" src="https://github.com/Curts0/PyTabular/actions/workflows/readthedocs.yml/badge.svg" /></a>
<a href="https://github.com/Curts0/PyTabular/actions/workflows/pages/pages-build-deployment"><img alt="pages-build-deployment" src="https://github.com/Curts0/PyTabular/actions/workflows/pages/pages-build-deployment/badge.svg" /></a>
<a href="https://github.com/Curts0/PyTabular/actions/workflows/flake8.yml"><img alt="flake8" src="https://github.com/Curts0/PyTabular/actions/workflows/flake8.yml/badge.svg?branch=master" /></a></p>
<h3 id="what-is-it">What is it?</h3>
<p><a href="https://github.com/Curts0/PyTabular">PyTabular</a> (python-tabular in <a href="https://pypi.org/project/python-tabular/">pypi</a>) is a python package that allows for programmatic execution on your tabular models! This is possible thanks to <a href="https://pythonnet.github.io/">Pythonnet</a> and Microsoft's <a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.analysisservices?view=analysisservices-dotnet">.Net APIs on Azure Analysis Services</a>. Currently, this build is tested and working on Windows Operating System only. Help is needed to expand this for other operating systems. The package should have the dll files included when you import it. See <a href="https://curts0.github.io/PyTabular/">Documentation Here</a>. PyTabular is still considered alpha while I'm working on building out the proper tests and testing environments, so I can ensure some kind of stability in features. Please send bugs my way! Preferably in the issues section in Github. I want to harden this project so many can use it easily. I currently have local pytest for python 3.6 to 3.10 and run those tests through a local AAS and Gen2 model.</p>
<h3 id="getting-started">Getting Started</h3>
<p>See the <a href="https://pypi.org/project/python-tabular/">Pypi project</a> for available version.</p>
<pre><code class="language-powershell">python3 -m pip install python-tabular
</code></pre>
<p>In your python environment, import pytabular and call the main Tabular Class. Only parameter needed is a solid connection string.</p>
<pre><code class="language-python">import pytabular
model = pytabular.Tabular(CONNECTION_STR)
</code></pre>
<p>I'm a big fan of logging, if you don't want any just get the logger and disable it.</p>
<pre><code class="language-python">import pytabular
pytabular.logger.disabled = True
</code></pre>
<p>You can query your models with the Query method from your tabular class. For Dax Queries, it will need the full Dax syntax. See <a href="https://dax.guide/st/evaluate/">EVALUATE example</a>. This will return a <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html">Pandas DataFrame</a>. If you are looking to return a single value, see below. Simply wrap your query in the the curly brackets. The method will take that single cell table and just return the individual value. You can also query your DMV. See below for example. See <a href="https://curts0.github.io/PyTabular/Tabular/#query">PyTabular Docs for Query</a>.</p>
<pre><code class="language-python">#Run basic queries
DAX_QUERY = &quot;EVALUATE TOPN(100, 'Table1')&quot;
model.Query(DAX_QUERY) #returns pd.DataFrame()

#or...
DMV_QUERY = &quot;select * from $SYSTEM.DISCOVER_TRACE_EVENT_CATEGORIES&quot;
model.Query(DMV_QUERY) #returns pd.DataFrame()

#or...
SINGLE_VALUE_QUERY_EX = &quot;EVALUATE {1}&quot;
model.Query(SINGLE_VALUE_QUERY_EX) #returns 1

#or...
FILE_PATH = 'C:\\FILEPATHEXAMPLE\\file.dax' #or file.txt
model.Query(FILE_PATH) #Will return same logic as above, single values if possible else will return pd.DataFrame()
</code></pre>
<p>You can also explore your tables, partitions, and columns. Via the Attributes from your Tabular class.</p>
<pre><code class="language-python">#Explore tables...
dir(model.Tables['Table Name'])

#Explore columns &amp; partitions
dir(model.Tables['Table Name'].Partitions['Partition Name'])

#Only a few features right now, but check out the built in methods.
model.Tables['Table Name'].Refresh(Tracing = True)
#or
model.Tables['Table Name'].Partitions['Partition Name'].Refresh(Tracing = True)
#or
model.Tables['Table Name'].Partitions['Partition Name'].Last_Refresh()
#or
model.Tables['Table Name'].Row_Count()
#or
model.Tables['Table Name'].Columns['Column Name'].Distinct_Count()
</code></pre>
<p>Refresh method to handle refreshes on your model. This is synchronous. Should be flexible enough to handle a variety of inputs. See <a href="https://curts0.github.io/PyTabular/Tabular/#refresh">PyTabular Docs for Refreshing Tables and Partitions</a>. Most basic way to refresh is input the table name string. The method will search for table and output exeption if unable to find it. For partitions you will need a key, value combination. Example, {'Table1':'Partition1'}. You can also take the key value pair and iterate through a group of partitions. Example, {'Table1':['Partition1','Partition2']}. Rather than providing a string, you can also input the actual class. See below for those examples, and you can acess them from the built in attributes self.Tables, self.Partitions or explore through the .Net classes yourself in self.Model.Tables.</p>
<pre><code class="language-python">#You have a few options when refreshing. 
model.Refresh('Table Name')

#or...
model.Refresh(['Table1','Table2','Table3'])

#or...
model.Refresh(&lt;Table Class&gt;)

#or...
model.Refresh(&lt;Partition Class&gt;)

#or...
model.Refresh({'Table Name':'Partition Name'})

#or any kind of weird combination like
model.Refresh([{&lt;Table Class&gt;:&lt;Partition Class&gt;,'Table Name':['Partition1','Partition2']},'Table Name','Table Name2'])

#You can even run through the Tables &amp; Partition Attributes
model.Tables['Table Name'].Refresh()

#or
model.Tables['Table Name'].Partitions['Partition Name'].Refresh()

#Default Tracing happens automatically, but can be removed by -- 
model.Refresh(['Table1','Table2'], trace = None)
</code></pre>
<p>It's not uncommon to need to run through some checks on specific Tables, Partitions, Columns, Etc...</p>
<pre><code class="language-python">#Get Row Count from model
model.Tables['Table Name'].Row_Count()

#Get Last Refresh time from a partition
model.Tables['Table Name'].Last_Refresh()

#Get Distinct Count or Values from a Column
model.Tables['Table Name'].Columns['Column Name'].Distinct_Count()
#or
model.Tables['Table Name'].Columns['Column Name'].Values()
</code></pre>
<h3 id="use-cases">Use Cases</h3>
<h4 id="if-blank-table-then-refresh-table">If blank table, then refresh table.</h4>
<p>This will use the function <a href="https://curts0.github.io/PyTabular/Examples/#return_zero_row_tables">Return_Zero_Row_Tables</a> and the method <a href="https://curts0.github.io/PyTabular/Tabular/#refresh">Refresh</a> from the Tabular class.</p>
<pre><code class="language-python">import pytabular
model = pytabular.Tabular(CONNECTION_STR)
tables = pytabular.Return_Zero_Row_Tables(model)
if len(tables) &gt; 0:
    model.Refresh(tables, Tracing = True) #Add a trace in there for some fun.
</code></pre>
<h4 id="sneak-in-a-refresh">Sneak in a refresh.</h4>
<p>This will use the method <a href="https://curts0.github.io/PyTabular/Tabular/#is_process">Is_Process</a> and the method <a href="https://curts0.github.io/PyTabular/Tabular/#refresh">Refresh</a> from the Tabular class. It will check the DMV to see if any jobs are currently running classified as processing.</p>
<pre><code class="language-python">import pytabular
model = pytabular.Tabular(CONNECTION_STR)
if model.Is_Process():
    #do what you want if there is a refresh happening
else:
    model.Refresh(TABLES_OR_PARTITIONS_TO_REFRESH)
</code></pre>
<h4 id="show-refresh-times-in-model">Show refresh times in model.</h4>
<p>This will use the function <a href="https://curts0.github.io/PyTabular/Examples/#table_last_refresh_times">Table_Last_Refresh_Times</a> and the method <a href="https://curts0.github.io/PyTabular/Tabular/#create_table">Create_Table</a> from the Tabular class. It will search through the model for all tables and partitions and pull the 'RefreshedTime' property from it. It will return results into a pandas dataframe, which will then be converted into an M expression used for a new table.</p>
<pre><code class="language-python">import pytabular
model = pytabular.Tabular(CONNECTION_STR)
df = pytabular.Table_Last_Refresh_Times(model, group_partition = False)
model.Create_Table(df, 'Refresh Times')
</code></pre>
<h4 id="if-bpa-violation-then-revert-deployment">If BPA Violation, then revert deployment.</h4>
<p>Uses a few things. First the <a href="https://curts0.github.io/PyTabular/Best%20Practice%20Analyzer/#bpa">BPA Class</a>, then the <a href="https://curts0.github.io/PyTabular/Tabular%20Editor%202/">TE2 Class</a>, and will finish with the <a href="https://curts0.github.io/PyTabular/Tabular/#analyze_bpa">Analyze_BPA</a> method. Did not want to re-invent the wheel with the amazing work done with Tabular Editor and it's BPA capabilities.</p>
<pre><code class="language-python">import pytabular
model = pytabular.Tabular(CONNECTION_STR)
TE2 = pytabular.Tabular_Editor() #Feel free to input your TE2 File path or this will download for you.
BPA = pytabular.BPA() #Fee free to input your own BPA file or this will download for you from: https://raw.githubusercontent.com/microsoft/Analysis-Services/master/BestPracticeRules/BPARules.json
results = model.Analyze_BPA(TE2.EXE,BPA.Location)

if len(results) &gt; 0:
    #Revert deployment here!
</code></pre>
<h4 id="backup-revert-a-table">Backup &amp; Revert a Table.</h4>
<p>USE WITH CAUTION, obviously not in PROD. I have been experimenting with this concept. Made for selfish reasons. Will probably get removed and I'll keep in my own local version. But fun to work with. Uses two methods. <a href="https://curts0.github.io/PyTabular/Tabular/#backup_table">Backup_Table</a> and <a href="https://curts0.github.io/PyTabular/Tabular/#revert_table">Revert_Table</a></p>
<pre><code class="language-python">import pytabular
model = pytabular.Tabular(CONNECTION_STR)
model.Backup_Table('TableName') #This will backup the table with surround items (columns,measures,relationships,roles,hierarchies,etc.) and will add a suffix of '_backup'
#-----------#
#Make any changes to your original table and then revert or delete backup as necessary
#-----------#
model.Revert_Table('TableName') #This will essentially replace your original with _backup
</code></pre>
<h4 id="loop-through-and-query-dax-files">Loop through and query Dax files</h4>
<p>Let's say you have multiple dax queries you would like to store and run through as checks. The <a href="https://curts0.github.io/PyTabular/Tabular/#query">Query</a> method on the Tabular class can also take file paths. Can really be any file type as it's just checking os.path.isfile(). But would suggest .dax or .txt. It will read the file that use that as the new Query_str argument.</p>
<pre><code class="language-python">import pytabular
model = pytabular.Tabular(CONNECTION_STR)
LIST_OF_FILE_PATHS = ['C:\\FilePath\\file1.dax','C:\\FilePath\\file1.txt','C:\\FilePath\\file2.dax','C:\\FilePath\\file2.txt']
for file_path in LIST_OF_FILE_PATHS:
    model.Query(file_path)
</code></pre>
<h4 id="advanced-refreshing-with-pre-and-post-checks">Advanced Refreshing with Pre and Post Checks</h4>
<p>Maybe you are introducing new logic to a fact table, and you need to ensure that a measure checking last month values never changes. To do that you can take advantage of the <code>Refresh_Check</code> and <code>Refresh_Check_Collection</code> classes (Sorry, I know the documentation stinks right now). But using those you can build out something that would first check the results of the measure, then refresh, then check the results of the measure after refresh, and lastly perform your desired check. In this case the <code>pre</code> value matches the <code>post</code> value. When refreshing and your pre does not equal post, it would fail and give an assertion error in your logging.</p>
<pre><code class="language-python">from pytabular import Tabular
from pytabular.refresh import Refresh_Check, Refresh_Check_Collection

model = Tabular(CONNECTION_STR)

# This is our custom check that we want to run after refresh.
# Does the pre refresh value match the post refresh value.
def sum_of_sales_assertion(pre, post):
    return pre == post

# This is where we put it all together into the `Refresh_Check` class. Give it a name, give it a query to run, and give it the assertion you want to make.
sum_of_last_month_sales = Refresh_Check(
    'Last Month Sales',
    lambda: model.Query(&quot;EVALUATE {[Last Month Sales]}&quot;)
    ,sum_of_sales_assertion
)

# Here we are adding it to a `Refresh_Check_Collection` because you can have more than on `Refresh_Check` to run.
all_refresh_check = Refresh_Check_Collection([sum_of_last_month_sales])

model.Refresh(
    'Fact Table Name',
    refresh_checks = Refresh_Check_Collection([sum_of_last_month_sales])

)
</code></pre>
<h4 id="query-as-another-user">Query as Another User</h4>
<p>There are plenty of tools that allow you to query as an 'Effective User' inheriting their security when querying. This is an extremely valuable concept built natively into the .Net apis. My only gripe is they were all UI based. This allows you to programmatically connect as an effective user and query in Python. You could easily loop through all your users to run tests on their security.</p>
<pre><code class="language-python">import pytabular as p

#Connect to your model like usual...
model = p.Tabular(CONNECTION_STR)

#This will be the query I run...
query_str = '''
EVALUATE
SUMMARIZE(
    'Product Dimension',
    'Product Dimension'[Product Name],
    &quot;Total Product Sales&quot;, [Total Sales]
)
'''
#This will be the user I want to query as...
user_email = 'user1@company.com'

#Base line, to query as the user connecting to the model.
model.Query(query_str)

#Option 1, Connect via connection class...
user1 = p.Connection(model.Server, Effective_User = user_email)
user1.Query(query_str)

#Option 2, Just add Effective_User
model.Query(query_str, Effective_User = user_email)

#PyTabular will do it's best to handle multiple accounts...
#So you won't have to reconnect on every query
</code></pre>
<h4 id="refresh-related-tables">Refresh Related Tables</h4>
<p>Ever need to refresh related tables of a Fact? Now should be a lot easier.</p>
<pre><code class="language-python">import pytabular as p

#Connect to model
model = p.Tabular(CONNECTION_STR)

#Get related tables
tables = model.Tables[TABLE_NAME].Related()

#Now just refresh like usual...
tables.Refresh()
</code></pre>
<h3 id="contributing">Contributing</h3>
<p>See <a href="CONTRIBUTING.md">CONTRIBUTING.md</a></p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="Tabular/" class="btn btn-neutral float-right" title="Tabular">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
      <span><a href="Tabular/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '.';</script>
    <script src="js/theme_extra.js" defer></script>
    <script src="js/theme.js" defer></script>
      <script src="search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>

<!--
MkDocs version : 1.4.2
Build Date UTC : 2022-12-12 20:50:38.061543+00:00
-->
